,target,doc
0,1,Modbus bit group light switch - change state object in code
1,1,## The problem
2,0,
3,1,Inconvenient mosbus switch control from register bits
4,0,
5,1,## Environment
6,1,Home Assistant 0.111.4
7,1,light Integration
8,0,
9,1,## Problem-relevant `configuration.yaml`
10,0,
11,0,```
12,0,
13,0,"# Configure a default setup of Home Assistant (frontend, api, etc)"
14,0,default_config:
15,0,
16,0,# Text to speech
17,0,tts:
18,0,  - platform: google_translate
19,0,
20,0,group: !include groups.yaml
21,0,automation: !include automations.yaml
22,0,script: !include scripts.yaml
23,0,scene: !include scenes.yaml
24,0,
25,0,#SSL
26,0,http:
27,0,  ssl_certificate: /ssl/fullchain.pem
28,0,  ssl_key: /ssl/privkey.pem
29,0,
30,0,
31,0,#Алиса
32,0,yandex_smart_home:
33,0,
34,0,# отладка модбас
35,0,logger:
36,0,  logs:
37,0,    homeassistant.components.modbus: debug
38,0,    pymodbus.client: debug
39,0,
40,0,
41,0,"# соединяем RS485-usb, запускаем мастер"
42,0,modbus:
43,0,  name: rs485usb
44,0,  type: serial
45,0,  method: rtu
46,0,  port: /dev/ttyUSB0
47,0,  baudrate: 19200
48,0,  stopbits: 1
49,0,  bytesize: 8
50,0,  parity: N
51,0,  timeout: 1
52,0,
53,0,
54,0,    
55,0,
56,0,
57,0,
58,0,sensor:
59,0,  platform: modbus
60,0,  scan_interval: 1
61,0,  registers:
62,0,    - name: Relay1floor1
63,0,      hub: rs485usb
64,0,      slave: 1
65,0,      register: 0
66,0,      count: 1
67,0,    - name: Relay1floor2
68,0,      hub: rs485usb
69,0,      slave: 1
70,0,      register: 1
71,0,      count: 1
72,0,    - name: Relay2floor1
73,0,      hub: rs485usb
74,0,      slave: 2
75,0,      register: 0
76,0,      count: 1
77,0,    - name: Relay2floor2
78,0,      hub: rs485usb
79,0,      slave: 2
80,0,      register: 1
81,0,      count: 1
82,0,
83,0,        
84,0,
85,0,
86,0,# создаем выключатели света модбас. Адрес в dec
87,0,
88,0,
89,0,
90,0,light:
91,0,  - platform: template
92,0,    lights:
93,0,# второй этаж нулевой Holding Register    
94,0,      checkroom_lights:
95,0,"        friendly_name: ""Гардеробная"""
96,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(256) > 0 }}"""
97,0,        turn_on:
98,0,          service: modbus.write_register
99,0,          data_template:
100,0,             address: 0
101,0,             hub: rs485usb
102,0,             unit: 2
103,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(256) }}"""
104,0,
105,0,        turn_off:
106,0,          service: modbus.write_register
107,0,          data_template:
108,0,             address: 0
109,0,             hub: rs485usb
110,0,             unit: 2
111,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65279) }}"""
112,0,             
113,0,             
114,0,      bedroom_lights:
115,0,"        friendly_name: ""Спальня"""
116,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(4096) > 0 }}"""
117,0,        turn_on:
118,0,          service: modbus.write_register
119,0,          data_template:
120,0,             address: 0
121,0,             hub: rs485usb
122,0,             unit: 2
123,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(4096) }}"""
124,0,
125,0,        turn_off:
126,0,          service: modbus.write_register
127,0,          data_template:
128,0,             address: 0
129,0,             hub: rs485usb
130,0,             unit: 2
131,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(61439) }}"""
132,0,
133,0,
134,0,
135,0,      kirill1_lights:
136,0,"        friendly_name: ""Кирилл1"""
137,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(1) > 0 }}"""
138,0,        turn_on:
139,0,          service: modbus.write_register
140,0,          data_template:
141,0,             address: 0
142,0,             hub: rs485usb
143,0,             unit: 2
144,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(1) }}"""
145,0,
146,0,        turn_off:
147,0,          service: modbus.write_register
148,0,          data_template:
149,0,             address: 0
150,0,             hub: rs485usb
151,0,             unit: 2
152,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65534) }}"""
153,0,
154,0,             
155,0,      bed_left:
156,0,"        friendly_name: ""Кровать лев."""
157,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(2) > 0 }}"""
158,0,        turn_on:
159,0,          service: modbus.write_register
160,0,          data_template:
161,0,             address: 0
162,0,             hub: rs485usb
163,0,             unit: 2
164,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(2) }}"""
165,0,
166,0,        turn_off:
167,0,          service: modbus.write_register
168,0,          data_template:
169,0,             address: 0
170,0,             hub: rs485usb
171,0,             unit: 2
172,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65533) }}"""
173,0,             
174,0,             
175,0,      kirill2_lights:
176,0,"        friendly_name: ""Кирилл2"""
177,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(4) > 0 }}"""
178,0,        turn_on:
179,0,          service: modbus.write_register
180,0,          data_template:
181,0,             address: 0
182,0,             hub: rs485usb
183,0,             unit: 2
184,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(4) }}"""
185,0,
186,0,        turn_off:
187,0,          service: modbus.write_register
188,0,          data_template:
189,0,             address: 0
190,0,             hub: rs485usb
191,0,             unit: 2
192,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65531) }}"""
193,0,             
194,0,      sw4_lights0_2floor:
195,0,"#        friendly_name: ""Гардеробная"""
196,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(8) > 0 }}"""
197,0,        turn_on:
198,0,          service: modbus.write_register
199,0,          data_template:
200,0,             address: 0
201,0,             hub: rs485usb
202,0,             unit: 2
203,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(8) }}"""
204,0,
205,0,        turn_off:
206,0,          service: modbus.write_register
207,0,          data_template:
208,0,             address: 0
209,0,             hub: rs485usb
210,0,             unit: 2
211,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65527) }}"""
212,0,             
213,0,      kirill3_lights:
214,0,"        friendly_name: ""Кирилл3"""
215,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(16) > 0 }}"""
216,0,        turn_on:
217,0,          service: modbus.write_register
218,0,          data_template:
219,0,             address: 0
220,0,             hub: rs485usb
221,0,             unit: 2
222,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(16) }}"""
223,0,
224,0,        turn_off:
225,0,          service: modbus.write_register
226,0,          data_template:
227,0,             address: 0
228,0,             hub: rs485usb
229,0,             unit: 2
230,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65519) }}"""
231,0,             
232,0,      sw6_lights0_2floor:
233,0,"#        friendly_name: ""Гардеробная"""
234,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(32) > 0 }}"""
235,0,        turn_on:
236,0,          service: modbus.write_register
237,0,          data_template:
238,0,             address: 0
239,0,             hub: rs485usb
240,0,             unit: 2
241,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(32) }}"""
242,0,
243,0,        turn_off:
244,0,          service: modbus.write_register
245,0,          data_template:
246,0,             address: 0
247,0,             hub: rs485usb
248,0,             unit: 2
249,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65503) }}"""
250,0,
251,0,             
252,0,      tanya1_lights:
253,0,"        friendly_name: ""Таня1"""
254,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(64) > 0 }}"""
255,0,        turn_on:
256,0,          service: modbus.write_register
257,0,          data_template:
258,0,             address: 0
259,0,             hub: rs485usb
260,0,             unit: 2
261,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(64) }}"""
262,0,
263,0,        turn_off:
264,0,          service: modbus.write_register
265,0,          data_template:
266,0,             address: 0
267,0,             hub: rs485usb
268,0,             unit: 2
269,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65471) }}"""
270,0,             
271,0,      sw8_lights0_2floor:
272,0,"#        friendly_name: ""Гардеробная"""
273,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(128) > 0 }}"""
274,0,        turn_on:
275,0,          service: modbus.write_register
276,0,          data_template:
277,0,             address: 0
278,0,             hub: rs485usb
279,0,             unit: 2
280,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(128) }}"""
281,0,
282,0,        turn_off:
283,0,          service: modbus.write_register
284,0,          data_template:
285,0,             address: 0
286,0,             hub: rs485usb
287,0,             unit: 2
288,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65407) }}"""
289,0,
290,0,             
291,0,      bed_right:
292,0,"        friendly_name: ""Кровать прав."""
293,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(512) > 0 }}"""
294,0,        turn_on:
295,0,          service: modbus.write_register
296,0,          data_template:
297,0,             address: 0
298,0,             hub: rs485usb
299,0,             unit: 2
300,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(512) }}"""
301,0,
302,0,        turn_off:
303,0,          service: modbus.write_register
304,0,          data_template:
305,0,             address: 0
306,0,             hub: rs485usb
307,0,             unit: 2
308,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65023) }}"""
309,0,             
310,0,      bedroom_led:
311,0,"        friendly_name: ""СпальняLED"""
312,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(1024) > 0 }}"""
313,0,        turn_on:
314,0,          service: modbus.write_register
315,0,          data_template:
316,0,             address: 0
317,0,             hub: rs485usb
318,0,             unit: 2
319,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(1024) }}"""
320,0,
321,0,        turn_off:
322,0,          service: modbus.write_register
323,0,          data_template:
324,0,             address: 0
325,0,             hub: rs485usb
326,0,             unit: 2
327,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(64511) }}"""
328,0,
329,0,             
330,0,      loft1_lights:
331,0,"        friendly_name: ""Чердак1"""
332,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(2048) > 0 }}"""
333,0,        turn_on:
334,0,          service: modbus.write_register
335,0,          data_template:
336,0,             address: 0
337,0,             hub: rs485usb
338,0,             unit: 2
339,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(2048) }}"""
340,0,
341,0,        turn_off:
342,0,          service: modbus.write_register
343,0,          data_template:
344,0,             address: 0
345,0,             hub: rs485usb
346,0,             unit: 2
347,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(-2049) }}"""
348,0,
349,0,             
350,0,      loft2_lights:
351,0,"        friendly_name: ""Чердак2"""
352,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(8192) > 0 }}"""
353,0,        turn_on:
354,0,          service: modbus.write_register
355,0,          data_template:
356,0,             address: 0
357,0,             hub: rs485usb
358,0,             unit: 2
359,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(8192) }}"""
360,0,
361,0,        turn_off:
362,0,          service: modbus.write_register
363,0,          data_template:
364,0,             address: 0
365,0,             hub: rs485usb
366,0,             unit: 2
367,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(57343) }}"""
368,0,             
369,0,      balcony_lights:
370,0,"        friendly_name: ""Балкон"""
371,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(16384) > 0 }}"""
372,0,        turn_on:
373,0,          service: modbus.write_register
374,0,          data_template:
375,0,             address: 0
376,0,             hub: rs485usb
377,0,             unit: 2
378,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(16384) }}"""
379,0,
380,0,        turn_off:
381,0,          service: modbus.write_register
382,0,          data_template:
383,0,             address: 0
384,0,             hub: rs485usb
385,0,             unit: 2
386,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(49151) }}"""
387,0,
388,0,             
389,0,      tanya2_lights:
390,0,"        friendly_name: ""Таня2"""
391,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(32768) > 0 }}"""
392,0,        turn_on:
393,0,          service: modbus.write_register
394,0,          data_template:
395,0,             address: 0
396,0,             hub: rs485usb
397,0,             unit: 2
398,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(32768) }}"""
399,0,
400,0,        turn_off:
401,0,          service: modbus.write_register
402,0,          data_template:
403,0,             address: 0
404,0,             hub: rs485usb
405,0,             unit: 2
406,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(32767) }}"""
407,0,             
408,0,# второй этаж первый Holding Register    
409,0,      sw01_lights1_2floor:
410,0,"#        friendly_name: ""Гардеробная"""
411,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(256) > 0 }}"""
412,0,        turn_on:
413,0,          service: modbus.write_register
414,0,          data_template:
415,0,             address: 1
416,0,             hub: rs485usb
417,0,             unit: 2
418,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(256) }}"""
419,0,
420,0,        turn_off:
421,0,          service: modbus.write_register
422,0,          data_template:
423,0,             address: 1
424,0,             hub: rs485usb
425,0,             unit: 2
426,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(65279) }}"""
427,0,             
428,0,      sw1_lights1_21floor:
429,0,"#        friendly_name: ""Гардеробная"""
430,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(1) > 0 }}"""
431,0,        turn_on:
432,0,          service: modbus.write_register
433,0,          data_template:
434,0,             address: 1
435,0,             hub: rs485usb
436,0,             unit: 2
437,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(1) }}"""
438,0,
439,0,        turn_off:
440,0,          service: modbus.write_register
441,0,          data_template:
442,0,             address: 1
443,0,             hub: rs485usb
444,0,             unit: 2
445,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(65534) }}"""
446,0,
447,0,             
448,0,      sw2_lights1_2floor:
449,0,"#        friendly_name: ""Гардеробная"""
450,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(2) > 0 }}"""
451,0,        turn_on:
452,0,          service: modbus.write_register
453,0,          data_template:
454,0,             address: 1
455,0,             hub: rs485usb
456,0,             unit: 2
457,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(2) }}"""
458,0,
459,0,        turn_off:
460,0,          service: modbus.write_register
461,0,          data_template:
462,0,             address: 1
463,0,             hub: rs485usb
464,0,             unit: 2
465,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(65533) }}"""
466,0,             
467,0,             
468,0,      sw3_lights1_2floor:
469,0,"#        friendly_name: ""Гардеробная"""
470,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(4) > 0 }}"""
471,0,        turn_on:
472,0,          service: modbus.write_register
473,0,          data_template:
474,0,             address: 1
475,0,             hub: rs485usb
476,0,             unit: 2
477,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(4) }}"""
478,0,
479,0,        turn_off:
480,0,          service: modbus.write_register
481,0,          data_template:
482,0,             address: 1
483,0,             hub: rs485usb
484,0,             unit: 2
485,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(65531) }}"""
486,0,             
487,0,      sw4_lights1_2floor:
488,0,"#        friendly_name: ""Гардеробная"""
489,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(8) > 0 }}"""
490,0,        turn_on:
491,0,          service: modbus.write_register
492,0,          data_template:
493,0,             address: 1
494,0,             hub: rs485usb
495,0,             unit: 2
496,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(8) }}"""
497,0,
498,0,        turn_off:
499,0,          service: modbus.write_register
500,0,          data_template:
501,0,             address: 1
502,0,             hub: rs485usb
503,0,             unit: 2
504,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(65527) }}"""
505,0,             
506,0,      sw5_lights1_2floor:
507,0,"#        friendly_name: ""Гардеробная"""
508,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(16) > 0 }}"""
509,0,        turn_on:
510,0,          service: modbus.write_register
511,0,          data_template:
512,0,             address: 1
513,0,             hub: rs485usb
514,0,             unit: 2
515,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(16) }}"""
516,0,
517,0,        turn_off:
518,0,          service: modbus.write_register
519,0,          data_template:
520,0,             address: 1
521,0,             hub: rs485usb
522,0,             unit: 2
523,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(65519) }}"""
524,0,             
525,0,      sw6_lights1_2floor:
526,0,"#        friendly_name: ""Гардеробная"""
527,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(32) > 0 }}"""
528,0,        turn_on:
529,0,          service: modbus.write_register
530,0,          data_template:
531,0,             address: 1
532,0,             hub: rs485usb
533,0,             unit: 2
534,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(32) }}"""
535,0,
536,0,        turn_off:
537,0,          service: modbus.write_register
538,0,          data_template:
539,0,             address: 1
540,0,             hub: rs485usb
541,0,             unit: 2
542,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(65503) }}"""
543,0,
544,0,             
545,0,      sw7_lights1_2floor:
546,0,"#        friendly_name: ""Гардеробная"""
547,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(64) > 0 }}"""
548,0,        turn_on:
549,0,          service: modbus.write_register
550,0,          data_template:
551,0,             address: 1
552,0,             hub: rs485usb
553,0,             unit: 2
554,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(64) }}"""
555,0,
556,0,        turn_off:
557,0,          service: modbus.write_register
558,0,          data_template:
559,0,             address: 1
560,0,             hub: rs485usb
561,0,             unit: 2
562,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(6571) }}"""
563,0,             
564,0,      sw8_lights1_2floor:
565,0,"#        friendly_name: ""Гардеробная"""
566,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(128) > 0 }}"""
567,0,        turn_on:
568,0,          service: modbus.write_register
569,0,          data_template:
570,0,             address: 1
571,0,             hub: rs485usb
572,0,             unit: 2
573,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(128) }}"""
574,0,
575,0,        turn_off:
576,0,          service: modbus.write_register
577,0,          data_template:
578,0,             address: 1
579,0,             hub: rs485usb
580,0,             unit: 2
581,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(65407) }}"""
582,0,
583,0,             
584,0,      sw9_lights1_2floor:
585,0,"#        friendly_name: ""Гардеробная"""
586,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(512) > 0 }}"""
587,0,        turn_on:
588,0,          service: modbus.write_register
589,0,          data_template:
590,0,             address: 1
591,0,             hub: rs485usb
592,0,             unit: 2
593,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(512) }}"""
594,0,
595,0,        turn_off:
596,0,          service: modbus.write_register
597,0,          data_template:
598,0,             address: 1
599,0,             hub: rs485usb
600,0,             unit: 2
601,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(65023) }}"""
602,0,             
603,0,      sw10_lights1_2floor:
604,0,"#        friendly_name: ""Гардеробная"""
605,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(1024) > 0 }}"""
606,0,        turn_on:
607,0,          service: modbus.write_register
608,0,          data_template:
609,0,             address: 1
610,0,             hub: rs485usb
611,0,             unit: 2
612,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(1024) }}"""
613,0,
614,0,        turn_off:
615,0,          service: modbus.write_register
616,0,          data_template:
617,0,             address: 1
618,0,             hub: rs485usb
619,0,             unit: 2
620,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(64511) }}"""
621,0,
622,0,             
623,0,      sw11_lights1_2floor:
624,0,"#        friendly_name: ""Гардеробная"""
625,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(2048) > 0 }}"""
626,0,        turn_on:
627,0,          service: modbus.write_register
628,0,          data_template:
629,0,             address: 1
630,0,             hub: rs485usb
631,0,             unit: 2
632,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(2048) }}"""
633,0,
634,0,        turn_off:
635,0,          service: modbus.write_register
636,0,          data_template:
637,0,             address: 1
638,0,             hub: rs485usb
639,0,             unit: 2
640,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(63487) }}"""
641,0,             
642,0,      sw12_lights1_2floor:
643,0,"#        friendly_name: ""Гардеробная"""
644,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(4096) > 0 }}"""
645,0,        turn_on:
646,0,          service: modbus.write_register
647,0,          data_template:
648,0,             address: 1
649,0,             hub: rs485usb
650,0,             unit: 2
651,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(4096) }}"""
652,0,
653,0,        turn_off:
654,0,          service: modbus.write_register
655,0,          data_template:
656,0,             address: 1
657,0,             hub: rs485usb
658,0,             unit: 2
659,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(61439) }}"""
660,0,
661,0,             
662,0,      sw13_lights1_2floor:
663,0,"#        friendly_name: ""Гардеробная"""
664,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(8192) > 0 }}"""
665,0,        turn_on:
666,0,          service: modbus.write_register
667,0,          data_template:
668,0,             address: 1
669,0,             hub: rs485usb
670,0,             unit: 2
671,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(8192) }}"""
672,0,
673,0,        turn_off:
674,0,          service: modbus.write_register
675,0,          data_template:
676,0,             address: 1
677,0,             hub: rs485usb
678,0,             unit: 2
679,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(57343) }}"""
680,0,             
681,0,      sw14_lights1_2floor:
682,0," #       friendly_name: ""Гардеробная"""
683,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(16384) > 0 }}"""
684,0,        turn_on:
685,0,          service: modbus.write_register
686,0,          data_template:
687,0,             address: 1
688,0,             hub: rs485usb
689,0,             unit: 2
690,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(16384) }}"""
691,0,
692,0,        turn_off:
693,0,          service: modbus.write_register
694,0,          data_template:
695,0,             address: 1
696,0,             hub: rs485usb
697,0,             unit: 2
698,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(49151) }}"""
699,0,
700,0,             
701,0,      sw15_lights1_2floor:
702,0,"#       friendly_name: ""Гардеробная"""
703,0,"        value_template: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(32768) > 0 }}"""
704,0,        turn_on:
705,0,          service: modbus.write_register
706,0,          data_template:
707,0,             address: 1
708,0,             hub: rs485usb
709,0,             unit: 2
710,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_or(32768) }}"""
711,0,
712,0,        turn_off:
713,0,          service: modbus.write_register
714,0,          data_template:
715,0,             address: 1
716,0,             hub: rs485usb
717,0,             unit: 2
718,0,"             value: ""{{ states('sensor.Relay2floor2')|int|bitwise_and(32767) }}"""
719,0,             
720,0,######################################################
721,0,
722,0,# первый этаж нулевой Holding Register    
723,0,      kitchen_led:
724,0,"        friendly_name: ""Кухня LED"""
725,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(256) > 0 }}"""
726,0,        turn_on:
727,0,          service: modbus.write_register
728,0,          data_template:
729,0,             address: 0
730,0,             hub: rs485usb
731,0,             unit: 1
732,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(256) }}"""
733,0,
734,0,        turn_off:
735,0,          service: modbus.write_register
736,0,          data_template:
737,0,             address: 0
738,0,             hub: rs485usb
739,0,             unit: 2
740,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65279) }}"""
741,0,             
742,0,             
743,0,      kitchen_light1:
744,0,"        friendly_name: ""Кухня1"""
745,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(4096) > 0 }}"""
746,0,        turn_on:
747,0,          service: modbus.write_register
748,0,          data_template:
749,0,             address: 0
750,0,             hub: rs485usb
751,0,             unit: 1
752,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(4096) }}"""
753,0,
754,0,        turn_off:
755,0,          service: modbus.write_register
756,0,          data_template:
757,0,             address: 0
758,0,             hub: rs485usb
759,0,             unit: 1
760,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(61439) }}"""
761,0,
762,0,
763,0,
764,0,      corridor_led:
765,0,"        friendly_name: ""Коридор LED"""
766,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(1) > 0 }}"""
767,0,        turn_on:
768,0,          service: modbus.write_register
769,0,          data_template:
770,0,             address: 0
771,0,             hub: rs485usb
772,0,             unit: 1
773,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(1) }}"""
774,0,
775,0,        turn_off:
776,0,          service: modbus.write_register
777,0,          data_template:
778,0,             address: 0
779,0,             hub: rs485usb
780,0,             unit: 1
781,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65534) }}"""
782,0,
783,0,             
784,0,      wc2_lights:
785,0,"        friendly_name: ""Туалет 2 этаж"""
786,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(2) > 0 }}"""
787,0,        turn_on:
788,0,          service: modbus.write_register
789,0,          data_template:
790,0,             address: 0
791,0,             hub: rs485usb
792,0,             unit: 1
793,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(2) }}"""
794,0,
795,0,        turn_off:
796,0,          service: modbus.write_register
797,0,          data_template:
798,0,             address: 0
799,0,             hub: rs485usb
800,0,             unit: 1
801,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65533) }}"""
802,0,             
803,0,             
804,0,      corridor_lights:
805,0,"        friendly_name: ""Коридор"""
806,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(4) > 0 }}"""
807,0,        turn_on:
808,0,          service: modbus.write_register
809,0,          data_template:
810,0,             address: 0
811,0,             hub: rs485usb
812,0,             unit: 1
813,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(4) }}"""
814,0,
815,0,        turn_off:
816,0,          service: modbus.write_register
817,0,          data_template:
818,0,             address: 0
819,0,             hub: rs485usb
820,0,             unit: 1
821,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65531) }}"""
822,0,             
823,0,      toilet2led:
824,0,"        friendly_name: ""Туалет LED"""
825,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(8) > 0 }}"""
826,0,        turn_on:
827,0,          service: modbus.write_register
828,0,          data_template:
829,0,             address: 0
830,0,             hub: rs485usb
831,0,             unit: 1
832,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(8) }}"""
833,0,
834,0,        turn_off:
835,0,          service: modbus.write_register
836,0,          data_template:
837,0,             address: 0
838,0,             hub: rs485usb
839,0,             unit: 1
840,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65527) }}"""
841,0,             
842,0,      bathroom2_1:
843,0,"        friendly_name: ""Ванная"""
844,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(16) > 0 }}"""
845,0,        turn_on:
846,0,          service: modbus.write_register
847,0,          data_template:
848,0,             address: 0
849,0,             hub: rs485usb
850,0,             unit: 1
851,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(16) }}"""
852,0,
853,0,        turn_off:
854,0,          service: modbus.write_register
855,0,          data_template:
856,0,             address: 0
857,0,             hub: rs485usb
858,0,             unit: 1
859,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65519) }}"""
860,0,             
861,0,      boiler_room_lights:
862,0,"        friendly_name: ""Котельная"""
863,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(32) > 0 }}"""
864,0,        turn_on:
865,0,          service: modbus.write_register
866,0,          data_template:
867,0,             address: 0
868,0,             hub: rs485usb
869,0,             unit: 1
870,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(32) }}"""
871,0,
872,0,        turn_off:
873,0,          service: modbus.write_register
874,0,          data_template:
875,0,             address: 0
876,0,             hub: rs485usb
877,0,             unit: 1
878,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65503) }}"""
879,0,
880,0,             
881,0,      bathroom2_2:
882,0,"        friendly_name: ""Ванная LED"""
883,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(64) > 0 }}"""
884,0,        turn_on:
885,0,          service: modbus.write_register
886,0,          data_template:
887,0,             address: 0
888,0,             hub: rs485usb
889,0,             unit: 1
890,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(64) }}"""
891,0,
892,0,        turn_off:
893,0,          service: modbus.write_register
894,0,          data_template:
895,0,             address: 0
896,0,             hub: rs485usb
897,0,             unit: 1
898,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65471) }}"""
899,0,             
900,0,      wc_light:
901,0,"        friendly_name: ""Туалет 1эт"""
902,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(128) > 0 }}"""
903,0,        turn_on:
904,0,          service: modbus.write_register
905,0,          data_template:
906,0,             address: 0
907,0,             hub: rs485usb
908,0,             unit: 1
909,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(128) }}"""
910,0,
911,0,        turn_off:
912,0,          service: modbus.write_register
913,0,          data_template:
914,0,             address: 0
915,0,             hub: rs485usb
916,0,             unit: 1
917,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65407) }}"""
918,0,
919,0,             
920,0,      living_room_lights2:
921,0,"        friendly_name: ""Зал2"""
922,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(512) > 0 }}"""
923,0,        turn_on:
924,0,          service: modbus.write_register
925,0,          data_template:
926,0,             address: 0
927,0,             hub: rs485usb
928,0,             unit: 1
929,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(512) }}"""
930,0,
931,0,        turn_off:
932,0,          service: modbus.write_register
933,0,          data_template:
934,0,             address: 0
935,0,             hub: rs485usb
936,0,             unit: 1
937,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65023) }}"""
938,0,             
939,0,      kitchen_light2:
940,0,"        friendly_name: ""Кухня2"""
941,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(1024) > 0 }}"""
942,0,        turn_on:
943,0,          service: modbus.write_register
944,0,          data_template:
945,0,             address: 0
946,0,             hub: rs485usb
947,0,             unit: 1
948,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(1024) }}"""
949,0,
950,0,        turn_off:
951,0,          service: modbus.write_register
952,0,          data_template:
953,0,             address: 0
954,0,             hub: rs485usb
955,0,             unit: 1
956,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(64511) }}"""
957,0,
958,0,             
959,0,      living_room_lights1:
960,0,"        friendly_name: ""Зал1"""
961,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(2048) > 0 }}"""
962,0,        turn_on:
963,0,          service: modbus.write_register
964,0,          data_template:
965,0,             address: 0
966,0,             hub: rs485usb
967,0,             unit: 1
968,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(2048) }}"""
969,0,
970,0,        turn_off:
971,0,          service: modbus.write_register
972,0,          data_template:
973,0,             address: 0
974,0,             hub: rs485usb
975,0,             unit: 1
976,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(-2049) }}"""
977,0,
978,0,             
979,0,      shower_room_lights2:
980,0,"        friendly_name: ""Душевая 2"""
981,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(8192) > 0 }}"""
982,0,        turn_on:
983,0,          service: modbus.write_register
984,0,          data_template:
985,0,             address: 0
986,0,             hub: rs485usb
987,0,             unit: 1
988,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(8192) }}"""
989,0,
990,0,        turn_off:
991,0,          service: modbus.write_register
992,0,          data_template:
993,0,             address: 0
994,0,             hub: rs485usb
995,0,             unit: 1
996,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(57343) }}"""
997,0,             
998,0,      shower_room_lights3:
999,0,"        friendly_name: ""Душевая 3"""
1000,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(16384) > 0 }}"""
1001,0,        turn_on:
1002,0,          service: modbus.write_register
1003,0,          data_template:
1004,0,             address: 0
1005,0,             hub: rs485usb
1006,0,             unit: 1
1007,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(16384) }}"""
1008,0,
1009,0,        turn_off:
1010,0,          service: modbus.write_register
1011,0,          data_template:
1012,0,             address: 0
1013,0,             hub: rs485usb
1014,0,             unit: 1
1015,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(49151) }}"""
1016,0,
1017,0,             
1018,0,      shower_room_lights1:
1019,0,"        friendly_name: ""Душевая 1"""
1020,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(32768) > 0 }}"""
1021,0,        turn_on:
1022,0,          service: modbus.write_register
1023,0,          data_template:
1024,0,             address: 0
1025,0,             hub: rs485usb
1026,0,             unit: 1
1027,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_or(32768) }}"""
1028,0,
1029,0,        turn_off:
1030,0,          service: modbus.write_register
1031,0,          data_template:
1032,0,             address: 0
1033,0,             hub: rs485usb
1034,0,             unit: 1
1035,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(32767) }}"""
1036,0,             
1037,0,# первый этаж первый Holding Register    
1038,0,      sw01_lights1_1floor:
1039,0,"#        friendly_name: ""Гардеробная"""
1040,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(256) > 0 }}"""
1041,0,        turn_on:
1042,0,          service: modbus.write_register
1043,0,          data_template:
1044,0,             address: 1
1045,0,             hub: rs485usb
1046,0,             unit: 1
1047,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(256) }}"""
1048,0,
1049,0,        turn_off:
1050,0,          service: modbus.write_register
1051,0,          data_template:
1052,0,             address: 1
1053,0,             hub: rs485usb
1054,0,             unit: 1
1055,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(65279) }}"""
1056,0,             
1057,0,      sw1_lights1_1floor:
1058,0,"#        friendly_name: ""Гардеробная"""
1059,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(1) > 0 }}"""
1060,0,        turn_on:
1061,0,          service: modbus.write_register
1062,0,          data_template:
1063,0,             address: 1
1064,0,             hub: rs485usb
1065,0,             unit: 1
1066,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(1) }}"""
1067,0,
1068,0,        turn_off:
1069,0,          service: modbus.write_register
1070,0,          data_template:
1071,0,             address: 1
1072,0,             hub: rs485usb
1073,0,             unit: 1
1074,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(65534) }}"""
1075,0,
1076,0,             
1077,0,      living_room3_light:
1078,0,"        friendly_name: ""Зал 3"""
1079,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(2) > 0 }}"""
1080,0,        turn_on:
1081,0,          service: modbus.write_register
1082,0,          data_template:
1083,0,             address: 1
1084,0,             hub: rs485usb
1085,0,             unit: 1
1086,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(2) }}"""
1087,0,
1088,0,        turn_off:
1089,0,          service: modbus.write_register
1090,0,          data_template:
1091,0,             address: 1
1092,0,             hub: rs485usb
1093,0,             unit: 1
1094,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(65533) }}"""
1095,0,             
1096,0,             
1097,0,      hallway_lights:
1098,0,"        friendly_name: ""Прихожая"""
1099,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(4) > 0 }}"""
1100,0,        turn_on:
1101,0,          service: modbus.write_register
1102,0,          data_template:
1103,0,             address: 1
1104,0,             hub: rs485usb
1105,0,             unit: 1
1106,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(4) }}"""
1107,0,
1108,0,        turn_off:
1109,0,          service: modbus.write_register
1110,0,          data_template:
1111,0,             address: 1
1112,0,             hub: rs485usb
1113,0,             unit: 1
1114,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(65531) }}"""
1115,0,             
1116,0,      sw4_lights1_1floor:
1117,0,"#        friendly_name: ""Гардеробная"""
1118,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(8) > 0 }}"""
1119,0,        turn_on:
1120,0,          service: modbus.write_register
1121,0,          data_template:
1122,0,             address: 1
1123,0,             hub: rs485usb
1124,0,             unit: 1
1125,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(8) }}"""
1126,0,
1127,0,        turn_off:
1128,0,          service: modbus.write_register
1129,0,          data_template:
1130,0,             address: 1
1131,0,             hub: rs485usb
1132,0,             unit: 1
1133,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(65527) }}"""
1134,0,             
1135,0,      storeroom_lights:
1136,0,"        friendly_name: ""Кладовка"""
1137,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(16) > 0 }}"""
1138,0,        turn_on:
1139,0,          service: modbus.write_register
1140,0,          data_template:
1141,0,             address: 1
1142,0,             hub: rs485usb
1143,0,             unit: 1
1144,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(16) }}"""
1145,0,
1146,0,        turn_off:
1147,0,          service: modbus.write_register
1148,0,          data_template:
1149,0,             address: 1
1150,0,             hub: rs485usb
1151,0,             unit: 1
1152,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(65519) }}"""
1153,0,             
1154,0,      hall2_light:
1155,0,"        friendly_name: ""Холл периметр"""
1156,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(32) > 0 }}"""
1157,0,        turn_on:
1158,0,          service: modbus.write_register
1159,0,          data_template:
1160,0,             address: 1
1161,0,             hub: rs485usb
1162,0,             unit: 1
1163,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(32) }}"""
1164,0,
1165,0,        turn_off:
1166,0,          service: modbus.write_register
1167,0,          data_template:
1168,0,             address: 1
1169,0,             hub: rs485usb
1170,0,             unit: 1
1171,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(65503) }}"""
1172,0,
1173,0,             
1174,0,      porch_lights:
1175,0,"        friendly_name: ""Крыльцо"""
1176,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(64) > 0 }}"""
1177,0,        turn_on:
1178,0,          service: modbus.write_register
1179,0,          data_template:
1180,0,             address: 1
1181,0,             hub: rs485usb
1182,0,             unit: 1
1183,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(64) }}"""
1184,0,
1185,0,        turn_off:
1186,0,          service: modbus.write_register
1187,0,          data_template:
1188,0,             address: 1
1189,0,             hub: rs485usb
1190,0,             unit: 1
1191,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(6571) }}"""
1192,0,             
1193,0,      hall1_light:
1194,0,"        friendly_name: ""Холл"""
1195,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(128) > 0 }}"""
1196,0,        turn_on:
1197,0,          service: modbus.write_register
1198,0,          data_template:
1199,0,             address: 1
1200,0,             hub: rs485usb
1201,0,             unit: 1
1202,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(128) }}"""
1203,0,
1204,0,        turn_off:
1205,0,          service: modbus.write_register
1206,0,          data_template:
1207,0,             address: 1
1208,0,             hub: rs485usb
1209,0,             unit: 1
1210,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(65407) }}"""
1211,0,
1212,0,             
1213,0,      sw9_lights1_1floor:
1214,0,"#        friendly_name: ""Гардеробная"""
1215,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(512) > 0 }}"""
1216,0,        turn_on:
1217,0,          service: modbus.write_register
1218,0,          data_template:
1219,0,             address: 1
1220,0,             hub: rs485usb
1221,0,             unit: 1
1222,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(512) }}"""
1223,0,
1224,0,        turn_off:
1225,0,          service: modbus.write_register
1226,0,          data_template:
1227,0,             address: 1
1228,0,             hub: rs485usb
1229,0,             unit: 1
1230,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(65023) }}"""
1231,0,             
1232,0,      sw10_lights1_1floor:
1233,0,"#        friendly_name: ""Гардеробная"""
1234,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(1024) > 0 }}"""
1235,0,        turn_on:
1236,0,          service: modbus.write_register
1237,0,          data_template:
1238,0,             address: 1
1239,0,             hub: rs485usb
1240,0,             unit: 1
1241,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(1024) }}"""
1242,0,
1243,0,        turn_off:
1244,0,          service: modbus.write_register
1245,0,          data_template:
1246,0,             address: 1
1247,0,             hub: rs485usb
1248,0,             unit: 1
1249,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(64511) }}"""
1250,0,
1251,0,             
1252,0,      cellar_lights:
1253,0,"        friendly_name: ""Подвал"""
1254,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(2048) > 0 }}"""
1255,0,        turn_on:
1256,0,          service: modbus.write_register
1257,0,          data_template:
1258,0,             address: 1
1259,0,             hub: rs485usb
1260,0,             unit: 1
1261,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(2048) }}"""
1262,0,
1263,0,        turn_off:
1264,0,          service: modbus.write_register
1265,0,          data_template:
1266,0,             address: 1
1267,0,             hub: rs485usb
1268,0,             unit: 1
1269,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(63487) }}"""
1270,0,             
1271,0,      sw12_lights1_1floor:
1272,0,"#        friendly_name: ""Гардеробная"""
1273,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(4096) > 0 }}"""
1274,0,        turn_on:
1275,0,          service: modbus.write_register
1276,0,          data_template:
1277,0,             address: 1
1278,0,             hub: rs485usb
1279,0,             unit: 1
1280,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(4096) }}"""
1281,0,
1282,0,        turn_off:
1283,0,          service: modbus.write_register
1284,0,          data_template:
1285,0,             address: 1
1286,0,             hub: rs485usb
1287,0,             unit: 1
1288,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(61439) }}"""
1289,0,
1290,0,             
1291,0,      sw13_lights1_1floor:
1292,0,"#        friendly_name: ""Гардеробная"""
1293,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(8192) > 0 }}"""
1294,0,        turn_on:
1295,0,          service: modbus.write_register
1296,0,          data_template:
1297,0,             address: 1
1298,0,             hub: rs485usb
1299,0,             unit: 1
1300,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(8192) }}"""
1301,0,
1302,0,        turn_off:
1303,0,          service: modbus.write_register
1304,0,          data_template:
1305,0,             address: 1
1306,0,             hub: rs485usb
1307,0,             unit: 1
1308,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(57343) }}"""
1309,0,             
1310,0,      sw14_lights1_1floor:
1311,0," #       friendly_name: ""Гардеробная"""
1312,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(16384) > 0 }}"""
1313,0,        turn_on:
1314,0,          service: modbus.write_register
1315,0,          data_template:
1316,0,             address: 1
1317,0,             hub: rs485usb
1318,0,             unit: 1
1319,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(16384) }}"""
1320,0,
1321,0,        turn_off:
1322,0,          service: modbus.write_register
1323,0,          data_template:
1324,0,             address: 1
1325,0,             hub: rs485usb
1326,0,             unit: 1
1327,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(49151) }}"""
1328,0,
1329,0,             
1330,0,      sw15_lights1_1floor:
1331,0,"#       friendly_name: ""Гардеробная"""
1332,0,"        value_template: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(32768) > 0 }}"""
1333,0,        turn_on:
1334,0,          service: modbus.write_register
1335,0,          data_template:
1336,0,             address: 1
1337,0,             hub: rs485usb
1338,0,             unit: 1
1339,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_or(32768) }}"""
1340,0,
1341,0,        turn_off:
1342,0,          service: modbus.write_register
1343,0,          data_template:
1344,0,             address: 1
1345,0,             hub: rs485usb
1346,0,             unit: 1
1347,0,"             value: ""{{ states('sensor.Relay1floor2')|int|bitwise_and(32767) }}"""
1348,0,             
1349,0,
1350,0,```
1351,0,
1352,1,## Traceback/Error logs
1353,1,No errors
1354,0,
1355,1,## Additional information
1356,0,
1357,0,
1358,0,
1359,1,I got arduino device which can toggle from modbus control.
1360,0,
1361,1,"For example, 2 light switche"
1362,1,s.
1363,0,
1364,1,in Holding Register 0000000000000011 is swith1 on and switch2 on
1365,1,in Holding Register 0000000000000010 is swith1 off and switch2 on
1366,1,etc
1367,0,
1368,1,For get state switches I use sensor with update interval is 1 second
1369,0,```
1370,0,sensor:
1371,0,  platform: modbus
1372,0,  scan_interval: 1
1373,0,  registers:
1374,0,    - name: Relay1floor1
1375,0,      hub: rs485usb
1376,0,      slave: 1
1377,0,      register: 0
1378,0,      count: 1
1379,0,```
1380,0,
1381,1,For  each swich use code:
1382,0,
1383,0,```
1384,0,light:
1385,0,  - platform: template
1386,0,    lights:
1387,0,# first switch   
1388,0,      checkroom_lights:
1389,0,     #get state switch1
1390,0,"        value_template: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(1) > 0 }}"""
1391,0,        turn_on:
1392,0,          service: modbus.write_register
1393,0,          data_template:
1394,0,             address: 0
1395,0,             hub: rs485usb
1396,0,             unit: 1
1397,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(1) }}"""
1398,0,#here I need manually change state Relay1floor1
1399,0,        turn_off:
1400,0,          service: modbus.write_register
1401,0,          data_template:
1402,0,             address: 0
1403,0,             hub: rs485usb
1404,0,             unit: 1
1405,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(65534) }}"""
1406,0,  #here I need manually change state Relay1floor1         
1407,0,             
1408,0,      bedroom_lights:
1409,0,       
1410,0,"        value_template: ""{{ states('sensor.Relay2floor1')|int|bitwise_and(2) > 0 }}"""
1411,0,        turn_on:
1412,0,          service: modbus.write_register
1413,0,          data_template:
1414,0,             address: 0
1415,0,             hub: rs485usb
1416,0,             unit: 2
1417,0,"             value: ""{{ states('sensor.Relay2floor1')|int|bitwise_or(2) }}"""
1418,0,# dec 2 is bin 0000 0000 0000 0010
1419,0,# bitwise_or(2) is change only second bit of Holding Register to 1
1420,0,#here I need manually change state Relay1floor1
1421,0,        
1422,0,
1423,0,        turn_off:
1424,0,          service: modbus.write_register
1425,0,          data_template:
1426,0,             address: 0
1427,0,             hub: rs485usb
1428,0,             unit: 2
1429,0,"             value: ""{{ states('sensor.Relay1floor1')|int|bitwise_and(65533) }}"""
1430,0,# dec 65533 is bin 1111 1111 1111 1101
1431,0,# bitwise_and(65533) is change only second bit of Holding Register to 0
1432,0,#here I need manually change state Relay1floor1
1433,0,```
1434,0,
1435,1,Its working for swiching manually not so quickly.
1436,0,
1437,1,Mouse click to switch1
1438,1,Fisically light1 is ON
1439,1,status light1 in hassio is off for 1 second
1440,1,After second hassio update  state Relay1floor1
1441,1,status light2 in hassio is ON
1442,0,
1443,1,Mouse click to switch2
1444,1,Fisically light2 is ON
1445,1,status light2 in hassio is off for 1 second
1446,1,After second hassio update  state Relay1floor1
1447,1,status light2 in hassio is ON
1448,0,
1449,0,
1450,1,But if I want quickly click to hassio switch1 and switch2 (delay between clicks less 1 second) my code not working.
1451,1,Cause states('sensor.Relay1floor1') must be change between clicks and hassio can't update modbus devices with timeout less 1 second.
1452,0,
1453,1,Especially noticeable problem for group switches.
1454,0,
1455,1,How can I manually change state Relay1floor1 in code for turn_on: and turn_off?
1456,0,
1457,1,"If developers add to modbus switch bit Holding Register controls, not only Coils and whole Holding Register, the problem will gone."
1458,0,
1459,0,
1460,0,
1461,0,
1462,0,
1463,0,     
